<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Child 1's Bedroom</title>
    <script src="https://cdn.tailwindcss.com"></script>
    </head>

    <style>
        .shake {
            animation: shake 0.4s ease;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-6px); }
            80% { transform: translateX(6px); }
            100% { transform: translateX(0); }
        }
        input[type="color"] {
            padding: 0 !important;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0 !important;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none !important;
            border-radius: 0.75rem;
        }
    </style>

    <body class="min-h-screen bg-gradient-to-br from-blue-200 to-blue-50 p-8">
        <!-- Back Button -->
        <a href="../rooms.html" class="inline-block mb-6 px-4 py-2 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700">
        ‚Üê Back
        </a>

        <p class="mt-2 mb-5 py-2 text-3xl text-black font-bold">Child 1's Bedroom Settings</p>

        <div class="p-6 bg-white shadow-xl rounded-3xl space-y-8">

        <!-- Lamp Card -->
        <div id="" class="p-6 rounded-3xl shadow-inner bg-gradient-to-b from-gray-900 to-gray-700">

            <h2 class="text-xl font-bold text-blue-200 mb-4">üí° Main Lamp</h2>

            <!-- Dark background + spotlight -->
            <div class="relative flex justify-center items-center">

            <!-- Dark room background -->
            <div class="absolute w-48 h-48 bg-black rounded-full blur-3xl opacity-70"></div>

            <!-- Lamp glow -->
            <div id="lampGlow"
                class="relative w-32 h-32 rounded-full transition-all duration-500 shadow-xl"
                style="background: #111;">
            </div>

            </div>

            <div class="flex items-center justify-between mt-5">
            <span class="font-medium text-gray-200">Lamp Status:</span>
            <button 
                id="lampToggle"
                class="px-4 py-2 rounded-xl font-semibold 
                    bg-gray-300 text-gray-900 hover:bg-gray-400 transition">
                OFF
            </button>
            </div>

            <!-- Brightness Slider -->
            <div class="mt-4">
                <label class="font-medium text-gray-300">
                    Brightness: <span id="brightnessValue" class="text-white font-semibold ml-1">50%</span>
                </label>

                <input id="brightnessSlider" 
                    type="range" 
                    min="1" 
                    max="100" 
                    value="50"
                    class="w-full accent-blue-500 mt-2">
            </div>

            <!-- Color Picker -->
            <div class="mt-0">
                <label class="font-medium text-gray-300">Light Color</label>
                <input id="colorPicker" type="color" value="#ffffff"
                    class="block w-full h-12 rounded-xl mt-2 cursor-pointer border border-gray-300">
            </div>
        </div>

        <!-- Door Lock -->
         <div id="doorWrapper"
        class="p-6 bg-gradient-to-br from-red-100 to-red-200 rounded-3xl shadow-xl border border-red-300/40 transition-all duration-700">

        <h2 class="text-2xl font-extrabold text-red-700 mb-4 text-center drop-shadow">
            üîí Smart Door Lock
        </h2>

        <!-- Lock Icon -->
        <div id="lockIcon"
            class="mx-auto text-7xl text-red-600 mb-2 flex justify-center transition-all duration-700 drop-shadow-lg">
            üîí
        </div>

        <!-- Status Text -->
        <div id="lockStatus"
            class="text-lg font-semibold text-red-700 mb-6 text-center tracking-wide">
            Locked
        </div>

        <!-- PIN Indicator -->
        <div id="pinDots" class="flex justify-center gap-3 mb-6">
            <div class="w-4 h-4 bg-white/50 rounded-full shadow-inner"></div>
            <div class="w-4 h-4 bg-white/50 rounded-full shadow-inner"></div>
            <div class="w-4 h-4 bg-white/50 rounded-full shadow-inner"></div>
            <div class="w-4 h-4 bg-white/50 rounded-full shadow-inner"></div>
        </div>

        <!-- Keypad -->
        <div id="keypad" class="grid grid-cols-3 gap-4 select-none">

            <button onclick="pressKey('1')" 
            class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">1</button>

            <button onclick="pressKey('2')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">2</button>

            <button onclick="pressKey('3')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">3</button>

            <button onclick="pressKey('4')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">4</button>

            <button onclick="pressKey('5')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">5</button>

            <button onclick="pressKey('6')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">6</button>

            <button onclick="pressKey('7')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">7</button>

            <button onclick="pressKey('8')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">8</button>
            
            <button onclick="pressKey('9')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">9</button>

            <div></div>

            <button onclick="pressKey('0')" class="text-2xl font-bold py-4 bg-white/70 backdrop-blur-sm rounded-2xl
            shadow-md hover:bg-white transition active:scale-95">0</button>

            <button onclick="clearPin()"
                    class="text-xl font-bold py-4 bg-red-400/80 text-white backdrop-blur rounded-2xl 
                        hover:bg-red-500 transition shadow-md">
                Clear
            </button>
        </div>

        <button id="lockAgainBtn"
                onclick="lockDoor()"
                class="w-full py-3 mt-6 rounded-xl font-bold bg-red-600 text-white 
                    hover:bg-red-700 transition hidden">
            Lock Door Again
        </button>

    </div>

</div>


        </div>

    </body>
</html>

<script src="../../iot-api.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const childLamp = initSmartLamp({
            deviceId: "child1-lamp-01", // <--- ID BEDA, LOGIC SAMA
            toggleBtn: document.getElementById("lampToggle"),
            glowEl: document.getElementById("lampGlow"),
            sliderEl: document.getElementById("brightnessSlider"),
            valueEl: document.getElementById("brightnessValue"),
            colorEl: document.getElementById("colorPicker")
        });
        registerDevice(childLamp);
    });
</script>

<script>
  // ------------------------
  // LAMP LOGIC
  // ------------------------
  let lampOn = false;
  const lampToggle = document.getElementById("lampToggle");
  const lampGlow = document.getElementById("lampGlow");
  const brightnessSlider = document.getElementById("brightnessSlider");
  const colorPicker = document.getElementById("colorPicker");

    const brightnessValue = document.getElementById("brightnessValue");

    brightnessSlider.addEventListener("input", () => {
        brightnessValue.textContent = brightnessSlider.value + "%";
    });

  function updateLampGlow() {
    if (!lampOn) {
      lampGlow.style.background = "#222";
      lampGlow.style.boxShadow = "none";
      return;
    }

    const color = colorPicker.value;
    const intensity = brightnessSlider.value / 10;

    lampGlow.style.background = color;
    lampGlow.style.boxShadow = `
      0 0 ${10 * intensity}px ${color},
      0 0 ${25 * intensity}px ${color}
    `;
  }

  lampToggle.addEventListener("click", () => {
    lampOn = !lampOn;

    if (lampOn) {
      lampToggle.textContent = "ON";
      lampToggle.classList.remove("bg-gray-300", "text-gray-800");
      lampToggle.classList.add("bg-green-500", "text-white");
    } else {
      lampToggle.textContent = "OFF";
      lampToggle.classList.add("bg-gray-300", "text-gray-800");
      lampToggle.classList.remove("bg-green-500", "text-white");
    }

    updateLampGlow();
  });

  brightnessSlider.addEventListener("input", updateLampGlow);
  colorPicker.addEventListener("input", updateLampGlow);

//   async function sendLampUpdateToAWS(brightness, powerState, colorHex) {

//     const awsEndpoint = "https://your-api-id.execute-api.region.amazonaws.com/prod/updateLamp";


//     const payload = {
//         brightness: brightness,     // number (0‚Äì100)
//         power: powerState,          // "on" or "off"
//         color: colorHex             // "#RRGGBB"
//     };

//     try {
//         const response = await fetch(awsEndpoint, {
//             method: "POST",
//             headers: {
//                 "Content-Type": "application/json"
//             },
//             body: JSON.stringify(payload)
//         });

//         const result = await response.json();

//         console.log("AWS Response:", result);
//         return result;

//     } catch (err) {
//         console.error("Failed to send data to AWS:", err);
//     }
// }
</script>

<script>
let pin = "";
const correctPin = "1234";

function pressKey(num) {
    if (pin.length >= 4) return;
    pin += num;
    updateDots();

    if (pin.length === 4) {
        validatePin();
    }
}

function updateDots() {
    const dots = document.querySelectorAll("#pinDots div");
    dots.forEach((d, i) => {
        d.style.background = i < pin.length ? "#dc2626" : "rgba(255,255,255,0.6)";
    });
}

function validatePin() {
    if (pin === correctPin) {
        unlockDoor();
    } else {
        wrongPin();
    }
}

function unlockDoor() {
    document.getElementById("lockIcon").textContent = "üîì";
    // document.getElementById("lockIcon").classList.add("scale-125");
    
    const status = document.getElementById("lockStatus");
    status.textContent = "Unlocked";
    status.classList.remove("text-red-700");
    status.classList.add("text-green-700");

    // Change background to green
    const wrapper = document.getElementById("doorWrapper");
    wrapper.classList.remove("from-red-100", "to-red-200");
    wrapper.classList.add("from-green-100", "to-green-200", "border-green-300/40");

    // Hide keypad, show lock again button
    document.getElementById("keypad").classList.add("hidden");
    document.getElementById("lockAgainBtn").classList.remove("hidden");

    clearPin();
}

function wrongPin() {
    const dots = document.getElementById("pinDots");
    dots.classList.add("shake");

    setTimeout(() => dots.classList.remove("shake"), 400);
    clearPin();
}

function clearPin() {
    pin = "";
    updateDots();
}

function lockDoor() {
    const status = document.getElementById("lockStatus");
    status.textContent = "Locked";
    status.classList.remove("text-green-700");
    status.classList.add("text-red-700");

    const wrapper = document.getElementById("doorWrapper");

    // return background to red
    wrapper.classList.add("from-red-100", "to-red-200", "border-red-300/40");
    wrapper.classList.remove("from-green-100", "to-green-200", "border-green-300/40");

    document.getElementById("lockIcon").textContent = "üîí";
    document.getElementById("lockIcon").classList.remove("scale-125");

    // Show keypad again
    document.getElementById("keypad").classList.remove("hidden");
    document.getElementById("lockAgainBtn").classList.add("hidden");
}
</script>
